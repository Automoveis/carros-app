<!DOCTYPE html>
<html lang="pt">
<head>
<meta charset="UTF-8">
<title>Calculadora Carros Autom√°tica</title>
<style>
body { font-family: Arial; margin: 40px; background: #f7f7f7; }
h1 { color: #333; }
input, button { padding: 8px; margin: 5px 0; width: 100%; max-width: 300px; }
button { background-color: #4CAF50; color: white; border: none; border-radius: 4px; cursor: pointer; }
table { border-collapse: collapse; width: 100%; margin-top: 20px; }
th, td { border: 1px solid #ddd; padding: 8px; text-align: center; }
th { background-color: #4CAF50; color: white; }
.verygood { color: darkgreen; font-weight: bold; }
.good { color: green; font-weight: bold; }
.medium { color: orange; font-weight: bold; }
.warning { color: darkorange; font-weight: bold; }
.bad { color: red; font-weight: bold; }
.exclude { color: gray; font-weight: bold; }
</style>
</head>
<body>

<h1>Calculadora Carros Autom√°tica</h1>

<label>Marca / Modelo:</label>
<input type="text" id="marcaModelo" placeholder="Ex: Ford Fiesta">
<label>Ano:</label>
<input type="number" id="ano" placeholder="Ex: 2015">
<label>Kil√≥metros:</label>
<input type="number" id="km" placeholder="Ex: 120000">
<label>Pre√ßo de Compra (‚Ç¨):</label>
<input type="number" id="precoCompra" placeholder="Ex: 3000">
<label>Despesas (‚Ç¨):</label>
<input type="number" id="despesas" placeholder="Ex: 300">
<button onclick="adicionarCarro()">Adicionar Carro</button>

<table id="tabelaCarros">
  <thead>
    <tr>
      <th>Marca/Modelo</th><th>Ano</th><th>Kms</th><th>Pre√ßo Compra</th>
      <th>Despesas</th><th>Pre√ßo M√©dio</th><th>Pre√ßo Venda Ideal</th>
      <th>Lucro Estimado</th><th>Margem %</th><th>Kms Avalia√ß√£o</th><th>Oportunidade</th>
    </tr>
  </thead>
  <tbody></tbody>
</table>

<script>
async function obterPrecoMedio(marca, modelo, ano){
    try {
        const res = await fetch('http://localhost:3000/preco-medio', {
            method: 'POST',
            headers: {'Content-Type':'application/json'},
            body: JSON.stringify({marca, modelo, ano})
        });
        const data = await res.json();
        return data.precoMedio || 0;
    } catch (err) {
        console.error(err);
        return 0;
    }
}

function calcularLucro(precoCompra){
    if(precoCompra<=2000) return 500;
    if(precoCompra<=3000) return 800;
    if(precoCompra<=5000) return 1100;
    if(precoCompra<=7000) return 1600;
    if(precoCompra<=10000) return 2100;
    if(precoCompra<=13000) return 3000;
    return 0;
}

function avaliarKms(kms){
    if(kms<50000) return {texto:'Excelente', classe:'verygood'};
    if(kms<100000) return {texto:'Muito bom', classe:'good'};
    if(kms<150000) return {texto:'Bom', classe:'medium'};
    if(kms<200000) return {texto:'Razo√°vel', classe:'warning'};
    if(kms<250000) return {texto:'Cuidado', classe:'bad'};
    if(kms<300000) return {texto:'Mau', classe:'bad'};
    return {texto:'N√£o integrar', classe:'exclude'};
}

function avaliarOportunidade(precoCompra, precoMedio, margem){
    if(margem>=20 && precoCompra<precoMedio) return '<span class="verygood">üü¢ Excelente oportunidade</span>';
    if(margem>=20) return '<span class="good">üü¢ Boa oportunidade</span>';
    if(margem>=15) return '<span class="medium">üü† Margem m√©dia</span>';
    return '<span class="bad">üî¥ Margem baixa</span>';
}

async function adicionarCarro(){
    const marcaModelo=document.getElementById('marcaModelo').value;
    const ano=parseInt(document.getElementById('ano').value)||0;
    const km=parseInt(document.getElementById('km').value)||0;
    const precoCompra=parseFloat(document.getElementById('precoCompra').value)||0;
    const despesas=parseFloat(document.getElementById('despesas').value)||0;

    const [marca, modelo] = marcaModelo.split(' ');
    const precoMedio = await obterPrecoMedio(marca, modelo || '', ano);

    const lucro = calcularLucro(precoCompra);
    const precoVenda = precoCompra + despesas + lucro;
    const margem = ((precoVenda-precoCompra-despesas)/(precoCompra+despesas)*100).toFixed(2);

    const kmsAvaliacao = avaliarKms(km);
    if(kmsAvaliacao.texto==='N√£o integrar'){ alert('Carro com mais de 300.000 km n√£o ser√° integrado'); return; }

    const oportunidade = avaliarOportunidade(precoCompra, precoMedio, margem);

    const tabela=document.getElementById('tabelaCarros').getElementsByTagName('tbody')[0];
    const row=tabela.insertRow();
    row.innerHTML=`
        <td>${marcaModelo}</td><td>${ano}</td><td>${km.toLocaleString()}</td>
        <td>‚Ç¨${precoCompra.toFixed(2)}</td><td>‚Ç¨${despesas.toFixed(2)}</td>
        <td>‚Ç¨${precoMedio.toFixed(2)}</td><td>‚Ç¨${precoVenda.toFixed(2)}</td>
        <td>‚Ç¨${lucro.toFixed(2)}</td><td>${margem}%</td>
        <td class="${kmsAvaliacao.classe}">${kmsAvaliacao.texto}</td><td>${oportunidade}</td>
    `;

    document.getElementById('marcaModelo').value='';
    document.getElementById('ano').value='';
    document.getElementById('km').value='';
    document.getElementById('precoCompra').value='';
    document.getElementById('despesas').value='';
}
</script>

</body>
</html>
